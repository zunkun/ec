(function(t){function e(e){for(var a,n,c=e[0],s=e[1],l=e[2],p=0,u=[];p<c.length;p++)n=c[p],i[n]&&u.push(i[n][0]),i[n]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);d&&d(e);while(u.length)u.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],a=!0,n=1;n<r.length;n++){var c=r[n];0!==i[c]&&(a=!1)}a&&(o.splice(e--,1),t=s(s.s=r[0]))}return t}var a={},n={app:0},i={app:0},o=[];function c(t){return s.p+"js/"+({}[t]||t)+"."+{"chunk-08a7e196":"6f150e25","chunk-3ef11149":"44833ddc","chunk-41c6b41a":"f063bfd1","chunk-c48178ac":"7f756e31"}[t]+".js"}function s(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.e=function(t){var e=[],r={"chunk-08a7e196":1,"chunk-3ef11149":1,"chunk-41c6b41a":1,"chunk-c48178ac":1};n[t]?e.push(n[t]):0!==n[t]&&r[t]&&e.push(n[t]=new Promise(function(e,r){for(var a="css/"+({}[t]||t)+"."+{"chunk-08a7e196":"0f51ee7f","chunk-3ef11149":"82adff3e","chunk-41c6b41a":"82adff3e","chunk-c48178ac":"0f51ee7f"}[t]+".css",i=s.p+a,o=document.getElementsByTagName("link"),c=0;c<o.length;c++){var l=o[c],p=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(p===a||p===i))return e()}var u=document.getElementsByTagName("style");for(c=0;c<u.length;c++){l=u[c],p=l.getAttribute("data-href");if(p===a||p===i)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var a=e&&e.target&&e.target.src||i,o=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=a,delete n[t],d.parentNode.removeChild(d),r(o)},d.href=i;var f=document.getElementsByTagName("head")[0];f.appendChild(d)}).then(function(){n[t]=0}));var a=i[t];if(0!==a)if(a)e.push(a[2]);else{var o=new Promise(function(e,r){a=i[t]=[e,r]});e.push(a[2]=o);var l,p=document.createElement("script");p.charset="utf-8",p.timeout=120,s.nc&&p.setAttribute("nonce",s.nc),p.src=c(t),l=function(e){p.onerror=p.onload=null,clearTimeout(u);var r=i[t];if(0!==r){if(r){var a=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+t+" failed.\n("+a+": "+n+")");o.type=a,o.request=n,r[1](o)}i[t]=void 0}};var u=setTimeout(function(){l({type:"timeout",target:p})},12e4);p.onerror=p.onload=l,document.head.appendChild(p)}return Promise.all(e)},s.m=t,s.c=a,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(r,a,function(e){return t[e]}.bind(null,a));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/eclient/",s.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],p=l.push.bind(l);l.push=e,l=l.slice();for(var u=0;u<l.length;u++)e(l[u]);var d=p;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"56d7":function(t,e,r){"use strict";r.r(e);r("96cf");var a=r("3b8d"),n=(r("cadf"),r("551c"),r("f751"),r("097d"),r("2b0e")),i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("router-view"),r("div",{staticStyle:{"margin-bottom":"60px"}}),r("van-tabbar",{model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[r("van-tabbar-item",{attrs:{icon:"orders-o",to:{name:"home"}}},[t._v("出差")]),t.$store.state.user.isLeader?r("van-tabbar-item",{attrs:{icon:"sign",info:t.$store.state.approvalCount,to:{name:"approvals",query:{type:0}}}},[t._v("审批")]):t._e(),r("van-tabbar-item",{attrs:{icon:"user-o",to:{name:"me"}}},[t._v("我")])],1)],1)},o=[],c={data:function(){return{active:0}}},s=c,l=r("2877"),p=Object(l["a"])(s,i,o,!1,null,null,null),u=p.exports,d=r("8c4f"),f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"home"}},[r("van-panel",{attrs:{title:"员工信息"}},[r("van-cell-group",[r("van-cell",{attrs:{title:"姓名",value:t.$store.state.user.userName}}),r("van-cell",{attrs:{title:"部门"},on:{click:t.showSelectDept}},[t._v("\n        "+t._s(t.trip.deptName)+"\n      ")])],1)],1),r("van-panel",{attrs:{title:"出差申请",desc:"出差基本信息"}},[r("van-field",{attrs:{type:"text",label:"出差简介",placeholder:"如“杭州出差”",required:""},model:{value:t.trip.trip.title,callback:function(e){t.$set(t.trip.trip,"title",e)},expression:"trip.trip.title"}}),r("van-field",{attrs:{type:"textarea",label:"出差事由",placeholder:"如“部门业务需要，去杭州出差”",required:""},model:{value:t.trip.trip.cause,callback:function(e){t.$set(t.trip.trip,"cause",e)},expression:"trip.trip.cause"}})],1),t._l(t.trip.itineraries,function(e,a){return r("van-panel",{key:"itinerary-"+a},[r("div",{staticClass:"panel-head",attrs:{slot:"header"},slot:"header"},[r("van-row",[r("van-col",{staticClass:"title",attrs:{span:"22"}},[t._v("\n          "+t._s("行程列表 "+(a+1))+"\n        ")]),r("van-col",{staticClass:"handle",attrs:{span:"2"}},[r("van-icon",{attrs:{name:"delete",color:"red",size:"20px"},on:{click:function(e){return t.deleteItinerary(a)}}})],1)],1)],1),r("van-cell",{attrs:{title:"行程类型",required:""},on:{click:function(e){return t.showSelectTripWay(a)}}},[t._v("\n      "+t._s(t.tripWayMap[e.tripWay])+"\n    ")]),r("van-cell",{attrs:{title:"交通方式",required:""},on:{click:function(e){return t.showSelectTraffic(a)}}},[t._v("\n      "+t._s(t.trafficMap[e.trafficType])+"\n    ")]),r("van-cell",{attrs:{title:"出发城市",required:""},on:{click:function(e){return t.showCity(a,"depCity")}}},[t._v("\n      "+t._s(t.trip.itineraries[a].depCity)+"\n    ")]),r("van-cell",{attrs:{title:"目的城市",required:""},on:{click:function(e){return t.showCity(a,"arrCity")}}},[t._v("\n      "+t._s(t.trip.itineraries[a].arrCity)+"\n    ")]),r("van-cell",{attrs:{title:"出发日期",required:""},on:{click:function(e){return t.showDatePicker(a,"depDate")}}},[t._v("\n      "+t._s(t.parseDateStr(e.depDate))+"\n    ")]),r("van-cell",{attrs:{title:"到达日期",required:""},on:{click:function(e){return t.showDatePicker(a,"arrDate")}}},[t._v("\n      "+t._s(t.parseDateStr(e.arrDate))+"\n    ")])],1)}),r("div",{staticClass:"button-area"},[r("van-button",{attrs:{block:"",type:"warning",plain:""},on:{click:t.addItinerary}},[t._v("新增行程")])],1),r("van-panel",{staticClass:"traveler-head",attrs:{title:"同行人员"}},[r("van-cell-group",[t._l(t.trip.cotravelers,function(e,a){return r("van-row",{key:"cotraveler-"+a,staticClass:"traveler-row"},[r("van-col",{attrs:{span:"22"}},[r("van-cell",{attrs:{title:"姓名",value:e.userName},on:{click:function(e){return t.selectTraveler(a)}}})],1),r("van-col",{attrs:{span:"2"}},[r("van-icon",{staticClass:"traveler-icon",attrs:{name:"delete"},on:{click:function(e){return t.deleteTraveler(a,"delete")}}})],1)],1)}),r("div",{staticClass:"button-area"},[r("van-button",{attrs:{block:"",type:"warning",plain:""},on:{click:t.addCotraveler}},[t._v("新增同行人员")])],1)],2)],1),r("div",{staticClass:"button-area"},[r("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.saveTrip}},[t._v("申请出差")])],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.deptSelectShow,callback:function(e){t.deptSelectShow=e},expression:"deptSelectShow"}},[r("van-picker",{attrs:{columns:t.departments,"show-toolbar":!0},on:{cancel:function(e){t.deptSelectShow=!1},confirm:t.selectDept}})],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.tripWaySelectShow,callback:function(e){t.tripWaySelectShow=e},expression:"tripWaySelectShow"}},[r("van-picker",{attrs:{columns:t.tripWayLists,"default-index":1,"show-toolbar":!0},on:{cancel:function(e){t.tripWaySelectShow=!1},confirm:t.selectTripWay}})],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.trafficShow,callback:function(e){t.trafficShow=e},expression:"trafficShow"}},[r("van-picker",{attrs:{columns:t.trafficLists,"default-index":0,"show-toolbar":!0},on:{cancel:function(e){t.trafficShow=!1},confirm:t.selectTraffic}})],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[r("van-datetime-picker",{attrs:{"show-toolbar":!0,type:"datetime"},on:{cancel:function(e){t.datePickerShow=!1},confirm:t.pickDate},model:{value:t.timeSelected,callback:function(e){t.timeSelected=e},expression:"timeSelected"}})],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.areaShow,callback:function(e){t.areaShow=e},expression:"areaShow"}},[r("van-area",{attrs:{"area-list":t.areaList,value:t.defaultArea[t.trafficType]},on:{cancel:function(e){t.areaShow=!1},confirm:t.pickCity}})],1),r("van-popup",{staticClass:"traverer-wrapper",attrs:{position:"center"},model:{value:t.travelerShow,callback:function(e){t.travelerShow=e},expression:"travelerShow"}},[r("van-tree-select",{attrs:{items:t.staffLists,height:t.treeHeight,"main-active-index":t.mainActiveIndex,"active-id":t.activeId},on:{navclick:t.onNavClick,itemclick:t.pickTraveler}})],1)],2)},h=[],v=(r("ac4d"),r("8a81"),r("ac6a"),r("7f7f"),{name:"home",data:function(){return{deptSelectShow:!1,departmentLists:[],departments:[],trip:{},defaultArea:{0:"421000",1:"401000",2:"310100",3:"310100"},itineraryIndex:0,tripWaySelectShow:!1,tripWayMap:{0:"单程",1:"往返"},tripWayLists:["单程","往返"],trafficType:0,trafficShow:!1,trafficMap:{0:"飞机",1:"火车",2:"汽车",3:"其他"},trafficLists:["飞机","火车","汽车","其他"],datePickerShow:!1,datePickType:"depDate",timeSelected:new Date,areaShow:!1,areaList:{province_list:{},city_list:{},county_list:{}},areaPickType:"depCity",travelerShow:!1,treeHeight:450,travelerIndex:0,mainActiveIndex:0,activeId:1,staffLists:[]}},methods:{initTrip:function(){this.trip={deptId:null,deptName:null,trip:{day:1,title:"",cause:""},itineraries:[{tripWay:1,trafficType:0,depCity:"上海",depCityCode:"",arrCity:"上海",arrCityCode:"",depDate:null,arrDate:null}],cotravelers:[]},this.departmentLists.length&&(this.trip.deptId=this.departmentLists[0].deptId,this.trip.deptName=this.departmentLists[0].deptName)},showSelectDept:function(){this.departments.length<=1||(this.deptSelectShow=!0)},selectDept:function(t,e){this.trip.deptId=this.departmentLists[e].deptId,this.trip.deptName=this.departmentLists[e].deptName,this.deptSelectShow=!1},showSelectTripWay:function(t){this.itineraryIndex=t||0,this.tripWaySelectShow=!0},selectTripWay:function(t,e){this.trip.itineraries[this.itineraryIndex].tripWay=e,this.tripWaySelectShow=!1},showSelectTraffic:function(t){this.itineraryIndex=t||0,this.trafficShow=!0},selectTraffic:function(t,e){this.trip.itineraries[this.itineraryIndex].trafficType=e,this.trafficShow=!1,this.trafficType=e,this.trip.itineraries[this.itineraryIndex].depCity="",this.trip.itineraries[this.itineraryIndex].arrCity="",this.getAreaLists()},getAreaLists:function(){var t=this;this.$http.get("/ec/api/area?type=".concat(this.trafficType)).then(function(e){var r=e.data;0===r.errcode&&(t.areaList=r.data)})},showCity:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"depCity";this.itineraryIndex=t||0,this.areaShow=!0,this.areaPickType=e},pickCity:function(t){this.trip.itineraries[this.itineraryIndex][this.areaPickType]=t[1].name,this.trip.itineraries[this.itineraryIndex]["".concat(this.areaPickType,"Code")]=t[1].code,this.areaShow=!1},showDatePicker:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"depDate";this.itineraryIndex=t||0,this.datePickType=e,this.datePickerShow=!0},pickDate:function(){var t=new Date(this.timeSelected);this.trip.itineraries[this.itineraryIndex][this.datePickType]=t,this.datePickerShow=!1},parseDateStr:function(t){return t?(t=new Date(t),"".concat(t.getFullYear(),"年").concat(t.getMonth()+1,"月").concat(t.getDate(),"日").concat(t.getHours(),"时").concat(t.getMinutes(),"分")):""},addItinerary:function(){this.trip.itineraries.push({tripWay:1,trafficType:0,depCity:"上海",depCityCode:"",arrCity:"上海",arrCityCode:"",depDate:null,arrDate:null})},deleteItinerary:function(t){this.$delete(this.trip.itineraries,t)},addCotraveler:function(){this.trip.cotravelers.push({userId:"",userName:"",deptId:"",deptName:""})},deleteTraveler:function(t){this.$delete(this.trip.cotravelers,t)},selectTraveler:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var r,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.travelerIndex=e||0,this.staffLists.length){t.next=9;break}return t.next=4,this.$http.get("/ec/api/staffs/depts");case 4:if(r=t.sent,a=r.data,0===a.errcode){t.next=8;break}return t.abrupt("return");case 8:this.staffLists=a.data||[];case 9:this.travelerShow=!0;case 10:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onNavClick:function(t){this.mainActiveIndex=t},pickTraveler:function(t){this.trip.cotravelers[this.travelerIndex]=t,this.travelerShow=!1},appendBudget:function(){var t=this;this.$http.post("/ec/api/approvals/append",this.trip).then(function(e){if(0===e.data.errcode)return t.$toast("已提交追加部门预算申请"),void t.initTrip();t.$toast("追加部门预算申请失败，请联系管理员")})},saveTrip:function(){var t=this,e=!0,r=this.trip;r.deptId||(e=!1),r.trip.title&&r.trip.cause||(e=!1);var a=r.itineraries||[],n=!0,i=!1,o=void 0;try{for(var c,s=a[Symbol.iterator]();!(n=(c=s.next()).done);n=!0){var l=c.value;if(l.tripWay&&l.depCity&&l.arrCity&&l.depDate&&l.arrDate||(e=!1),!e)break}}catch(p){i=!0,o=p}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}e?this.$http.get("/ec/api/fees/balance?deptId=".concat(r.deptId)).then(function(e){var a=e.data;if(0===a.errcode){var n=a.data.approval;n?t.$http.post("/ec/api/approvals",r).then(function(e){var r=e.data;0!==r.errcode?t.$toast("出差申请单填写失败，请重新申请或者联系管理员"):t.$toast("出差申请单填写成功，请等待领导审批")}):t.$dialog.confirm({message:"部门预算不足，是否申请追加预算"}).then(function(){return t.appendBudget()}).catch(function(){t.$toast("已取消申请追加预算")})}else t.$toast("申请失败,".concat(a.errmsg))}).catch(function(){t.$toast("出差申请单填写失败，请重新申请或者联系管理员")}):this.$toast("申请单填写不正确，请正确填写")}},created:function(){if(this.initTrip(),this.$store.state.user){var t=this.$store.state.user.departments||[],e=!0,r=!1,a=void 0;try{for(var n,i=t[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;this.departments.push(o.deptName)}}catch(c){r=!0,a=c}finally{try{e||null==i.return||i.return()}finally{if(r)throw a}}this.departmentLists=t,this.trip.deptId=t[0].deptId,this.trip.deptName=t[0].deptName}this.getAreaLists()}}),m=v,y=(r("cccb"),Object(l["a"])(m,f,h,!1,null,null,null)),k=y.exports,S=r("2f62");n["a"].use(S["a"]);var w=new S["a"].Store({state:{approvalCount:null,user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{}},mutations:{setUser:function(t,e){t.user=e},setApprovalCount:function(t,e){t.approvalCount=e||null}}}),b=r("bc3a"),g=r.n(b);n["a"].use(d["a"]);var I=new d["a"]({base:"/eclient/",routes:[{path:"/",name:"home",component:k,meta:{title:"出差申请",isAuth:!0}},{path:"/me",name:"me",component:function(){return r.e("chunk-08a7e196").then(r.bind(null,"0a99"))},meta:{title:"我的出差",isAuth:!0}},{path:"/apply",name:"apply",component:function(){return r.e("chunk-3ef11149").then(r.bind(null,"1533"))},meta:{title:"申请单明细",isAuth:!0}},{path:"/approvals",name:"approvals",component:function(){return r.e("chunk-c48178ac").then(r.bind(null,"1f5a"))},meta:{title:"出差审批",isAuth:!0}},{path:"/approval",name:"approval",component:function(){return r.e("chunk-41c6b41a").then(r.bind(null,"71ff"))},meta:{title:"出差审批",isAuth:!0}}]});I.beforeEach(function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e,r,a){var n,i,o,c,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e.meta.title&&(document.title=e.meta.title),!e.matched.some(function(t){return t.meta.isAuth})){t.next=10;break}if(n=w.state.token||localStorage.getItem("token"),n){t.next=10;break}if(!e.query.userId){t.next=10;break}return t.next=7,g.a.get("/ec/api/auth/login?userId=".concat(e.query.userId));case 7:i=t.sent,o=i.data,0===o.errcode&&(c=o.data.user,s=o.data.token,localStorage.setItem("user",JSON.stringify(c)),localStorage.setItem("token",s),w.commit("setUser",c),window.location.reload());case 10:a();case 11:case"end":return t.stop()}},t)}));return function(e,r,a){return t.apply(this,arguments)}}());var x=I,C={corpId:"ding9f71dd70c3adb557",corpName:"海尔融资租赁股份有限公司"},T=C,_=r("2c18"),D=r("b970");r("157a");n["a"].use(D["a"]),n["a"].config.productionTip=!1,n["a"].prototype.GLOBAL=T,n["a"].prototype.$http=g.a;var N=localStorage.getItem("token");alert(N),alert(T.corpId),alert(T.corpName),N?g.a.interceptors.request.use(function(t){return t.headers.Authorization=localStorage.getItem("token"),t},function(t){return Promise.reject(t)}):_["ready"](function(){_["runtime"].permission.requestAuthCode({corpId:T.corpId,onSuccess:function(t){alert(JSON.stringify(t)),alert("/ec/api/auth/login?corpId=".concat(T.corpId,"&code=").concat(t.code)),g.a.get("/ec/api/auth/login?corpId=".concat(T.corpId,"&code=").concat(t.code)).then(function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var r,a,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:alert(111),alert(JSON.stringify(e)),r=e.data,0===r.errcode&&(a=r.data.user,n=r.data.token,localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("token",n),w.commit("setUser",a));case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){alert(222),alert(JSON.stringify(t))})},onFail:function(t){alert(JSON.stringify(t)),alert("获取用户信息失败")}})}),new n["a"]({router:x,store:w,render:function(t){return t(u)}}).$mount("#app")},cccb:function(t,e,r){"use strict";var a=r("d563"),n=r.n(a);n.a},d563:function(t,e,r){}});
//# sourceMappingURL=app.7ed7d4b4.js.map