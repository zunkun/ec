(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e1560162"],{"18f3":function(t,e,a){"use strict";var n=a("8d3c"),r=a.n(n);r.a},1946:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"formbasic"}},[a("van-panel",{attrs:{title:"基本信息"}},[a("van-cell-group",[a("van-cell",{attrs:{title:"姓名",value:t.application.userName}}),a("van-cell",{attrs:{title:"部门"}},[t._v("\n        "+t._s(t.application.deptName)+"\n      ")])],1)],1),a("van-panel",{attrs:{title:"申请原因"}},[a("van-field",{attrs:{type:"textarea",readonly:""},model:{value:t.application.cause,callback:function(e){t.$set(t.application,"cause",e)},expression:"application.cause"}})],1)],1)},r=[],s={name:"formbasic",props:["application"],data:function(){return{}}},o=s,i=a("2877"),c=Object(i["a"])(o,n,r,!1,null,null,null);e["a"]=c.exports},"1af6":function(t,e,a){var n=a("63b6");n(n.S,"Array",{isArray:a("9003")})},"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},"583c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"budget"}},[a("FormBasic",{attrs:{application:t.application}}),a("div",{staticClass:"pz"},t._l(t.process.applications,function(e,n){return a("div",{key:"application-"+n},[e.approvalTime||e.approvalUser?a("div",{staticClass:"note"},[a("p",[a("strong",[t._v("审批人:")]),t._v(" "+t._s(e.approvalUser.userName))]),e.note?a("p",[a("strong",[t._v("意见:")]),t._v(" "+t._s(e.note))]):t._e(),e.approvalTime?a("p",[a("strong",[t._v("时间:")]),t._v(" "+t._s(t.parseTime(e.approvalTime)))]):t._e(),a("p",[a("strong",[t._v("结果:")]),t._v(" "+t._s(t.applicationStatusMap[e.status]))])]):t._e()])}),0),a("div",{staticClass:"pz2"},[a("p",[a("strong",[t._v("当前状态:")]),a("span",{staticClass:"statusz"},[t._v("  "+t._s(t.statusMap[t.process.status]))])])]),"application"===t.type&&[10,20].indexOf(t.process.status)>-1?a("div",[a("van-panel",{attrs:{title:"审批意见"}},[a("van-field",{attrs:{type:"textarea",placeholder:"审批意见（选填）"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}})],1),a("div",{staticClass:"button-area"},[a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"danger",plain:""},on:{click:t.reject}},[t._v("驳 回")])],1),a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.agree}},[t._v("同 意")])],1)],1)],1)],1):t._e(),"finance"===t.type&&[30,31,40,50].indexOf(t.process.status)>-1?a("div",[t._l(t.process.from,function(e,n){return a("van-panel",{key:"from-"+n},[a("div",{staticClass:"panel-head",attrs:{slot:"header"},slot:"header"},[a("van-row",[a("van-col",{staticClass:"title",attrs:{span:"22"}},[t._v("\n            "+t._s("调出部门("+(n+1)+")")+"\n          ")]),a("van-col",{staticClass:"handle",attrs:{span:"2"}},[a("van-icon",{attrs:{name:"delete",color:"red",size:"20px"},on:{click:function(e){return t.deleteFrom(n)}}})],1)],1)],1),a("van-cell",{attrs:{title:"部门","is-link":"",required:""},on:{click:function(e){return t.showPickDept(n)}}},[t._v("\n        "+t._s(e.name)+"\n      ")]),a("van-field",{attrs:{type:"number",label:"金额(元)",placeholder:"请输入金额",required:""},on:{blur:t.computeAmount},model:{value:e.amount,callback:function(a){t.$set(e,"amount",a)},expression:"item.amount"}})],1)}),a("div",{staticClass:"button-area"},[a("van-button",{attrs:{block:"",type:"warning",plain:""},on:{click:t.addFrom}},[a("span",{staticClass:"icon-btn"},[t._v("+")]),t._v(" 增加调出项")])],1),a("van-panel",{attrs:{title:"调入部门"}},[t.application.group?a("van-cell",{attrs:{title:"部门"}},[t._v(" "+t._s(t.application.group.name))]):t._e(),a("van-cell",{ref:"processvalue",attrs:{title:"金额(元)",label:"结果自动计算"}},[t._v(t._s(t.total))])],1),a("div",{staticClass:"button-area"},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.modifyFinance}},[t._v("调 整")])],1)],2):t._e(),a("van-popup",{attrs:{position:"bottom"},model:{value:t.deptSelectShow,callback:function(e){t.deptSelectShow=e},expression:"deptSelectShow"}},[a("van-picker",{attrs:{columns:t.groupcolumns,"show-toolbar":!0},on:{cancel:function(e){t.deptSelectShow=!1},confirm:t.selectDept}})],1)],1)},r=[],s=(a("c5f6"),a("7f7f"),a("768b")),o=(a("ac4d"),a("8a81"),a("ac6a"),a("1946")),i={name:"budget",components:{FormBasic:o["a"]},data:function(){return{active:0,type:"applications",application:{group:{}},process:{group:{},from:[],count:0},processLists:[],note:"",applicationStatusMap:{10:"审批中",20:"同意",30:"拒绝"},statusMap:{10:"审批中",11:"员工取消",20:"审批中",21:"主管拒绝",30:"财务调整中",31:"财务撤回",40:"调出部门审批中",50:"调入部门审批中",60:"审批通过",61:"审批通过",62:"审批通过"},groupLists:[],groupcolumns:[],total:0,fromIndex:0,deptSelectShow:!1}},methods:{parseTime:function(t){return t=new Date(t),"".concat(t.getFullYear(),"年").concat(t.getMonth()+1,"月").concat(t.getDate(),"日").concat(t.getHours(),"时").concat(t.getMinutes(),"分")},setType:function(){},getApplication:function(){var t=this;this.$route.query.id&&this.$http.get("/ec/api/applications/".concat(this.$route.query.id)).then(function(e){var a=e.data;0!==a.errcode?t.$toast.fail("获取费用申请单失败"):t.application=a.data})},initProcess:function(){this.processLists.push({title:"申请预算",userNames:[]});var t=!0,e=!1,a=void 0;try{for(var n,r=this.process.applications.entries()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=Object(s["a"])(n.value,2),i=o[0],c=o[1],l={title:"第".concat(i+1,"级主管审批"),userNames:[]};c.deptId===this.process.deptId&&(l.title="直接主管审批");var p=!0,u=!1,f=void 0;try{for(var v,h=c.users[Symbol.iterator]();!(p=(v=h.next()).done);p=!0){var d=v.value;l.userNames.push(d.userName)}}catch(x){u=!0,f=x}finally{try{p||null==h.return||h.return()}finally{if(u)throw f}}this.processLists.push(l)}}catch(x){e=!0,a=x}finally{try{t||null==r.return||r.return()}finally{if(e)throw a}}var m={title:"财务调整",userNames:[]},y=!0,b=!1,g=void 0;try{for(var _,w=this.process.finances.users[Symbol.iterator]();!(y=(_=w.next()).done);y=!0){c=_.value;m.userNames.push(c.userName)}}catch(x){b=!0,g=x}finally{try{y||null==w.return||w.return()}finally{if(b)throw g}}this.processLists.push(m),this.processLists.push({title:"预算调出部门领导审批",userNames:[]}),this.processLists.push({title:"预算调入部门领导审批",userNames:[]}),this.processLists.push({title:"预算调整",userNames:[]}),this.process.from.length||(this.process.from=this.process.from.concat({code:"",name:"",amount:0}),this.process.count=0),this.total=this.process.count},getProcess:function(){var t=this;this.$route.query.id&&this.$http.get("/ec/api/processes/application/".concat(this.$route.query.id)).then(function(e){var a=e.data;if(0===a.errcode)return t.process=a.data,void t.initProcess()})},getGroupLists:function(){var t=this;this.$http.get("/ec/api/depts/grouplists").then(function(e){var a=e.data;if(0!==a.errcode);else{t.groupLists=a.data||[];var n=!0,r=!1,s=void 0;try{for(var o,i=t.groupLists[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;t.groupcolumns.push(c.name)}}catch(l){r=!0,s=l}finally{try{n||null==i.return||i.return()}finally{if(r)throw s}}}})},reject:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/reject"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("拒绝成功"),void t.getProcess();t.$toast.fail("拒绝失败")})},agree:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/agree"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},addFrom:function(){this.process.from||(this.process.from=[]),this.process.from=this.process.from.concat({code:"",name:"",amount:0})},deleteFrom:function(t){this.$delete(this.process.from,t),this.computeAmount()},computeAmount:function(){var t=0,e=!0,a=!1,n=void 0;try{for(var r,s=this.process.from[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;t+=Number(o.amount)}}catch(i){a=!0,n=i}finally{try{e||null==s.return||s.return()}finally{if(a)throw n}}this.$set(this.process,"count",t),this.total=t},showPickDept:function(t){this.fromIndex=t||0,this.deptSelectShow=!0},selectDept:function(t,e){if(this.name!==this.process.group.name){var a=this.groupLists[e];this.process.from[this.fromIndex].name=a.name,this.process.from[this.fromIndex].code=a.code,this.deptSelectShow=!1}else this.$toast("转入转出部门不能相同")},validateFinance:function(){var t=this.process.from||[],e=!0;if(!this.process.count)return!1;var a=!0,n=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var i=s.value;if(!i.amount||!i.code){e=!1;break}}}catch(c){n=!0,r=c}finally{try{a||null==o.return||o.return()}finally{if(n)throw r}}return e},modifyFinance:function(){var t=this.validateFinance();t||this.$toast("请正确填入调出项目")}},created:function(){this.type=this.$route.query.type||"application",this.getApplication(),this.getProcess(),"finance"===this.type&&this.getGroupLists()}},c=i,l=(a("18f3"),a("2877")),p=Object(l["a"])(c,n,r,!1,null,null,null);e["default"]=p.exports},"5d73":function(t,e,a){t.exports=a("469f")},"768b":function(t,e,a){"use strict";var n=a("a745"),r=a.n(n);function s(t){if(r()(t))return t}var o=a("5d73"),i=a.n(o);function c(t,e){var a=[],n=!0,r=!1,s=void 0;try{for(var o,c=i()(t);!(n=(o=c.next()).done);n=!0)if(a.push(o.value),e&&a.length===e)break}catch(l){r=!0,s=l}finally{try{n||null==c["return"]||c["return"]()}finally{if(r)throw s}}return a}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function p(t,e){return s(t)||c(t,e)||l()}a.d(e,"a",function(){return p})},"7d7b":function(t,e,a){var n=a("e4ae"),r=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},"7f7f":function(t,e,a){var n=a("86cc").f,r=Function.prototype,s=/^\s*function ([^ (]*)/,o="name";o in r||a("9e1e")&&n(r,o,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(t){return""}}})},"8d3c":function(t,e,a){},9003:function(t,e,a){var n=a("6b4c");t.exports=Array.isArray||function(t){return"Array"==n(t)}},a745:function(t,e,a){t.exports=a("f410")},f410:function(t,e,a){a("1af6"),t.exports=a("584a").Array.isArray}}]);
//# sourceMappingURL=chunk-e1560162.abf96188.js.map