(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e1560162"],{"18f3":function(t,e,a){"use strict";var s=a("8d3c"),n=a.n(s);n.a},1946:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"formbasic"}},[a("van-panel",{attrs:{title:"基本信息"}},[a("van-cell-group",[a("van-cell",{attrs:{title:"姓名",value:t.application.userName}}),a("van-cell",{attrs:{title:"部门"}},[t._v("\n        "+t._s(t.application.deptName)+"\n      ")])],1)],1),a("van-panel",{attrs:{title:"申请原因"}},[a("van-field",{attrs:{type:"textarea",readonly:""},model:{value:t.application.cause,callback:function(e){t.$set(t.application,"cause",e)},expression:"application.cause"}})],1)],1)},n=[],o={name:"formbasic",props:["application"],data:function(){return{}}},r=o,i=a("2877"),c=Object(i["a"])(r,s,n,!1,null,null,null);e["a"]=c.exports},"1af6":function(t,e,a){var s=a("63b6");s(s.S,"Array",{isArray:a("9003")})},"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},"583c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"budget"}},[a("FormBasic",{attrs:{application:t.application}}),a("div",{staticClass:"pz"},t._l(t.process.applications,function(e,s){return a("div",{key:"application-"+s},[e.approvalTime||e.approvalUser?a("div",{staticClass:"note"},[a("p",[a("strong",[t._v("审批人:")]),t._v(" "+t._s(e.approvalUser.userName))]),e.note?a("p",[a("strong",[t._v("意见:")]),t._v(" "+t._s(e.note))]):t._e(),e.approvalTime?a("p",[a("strong",[t._v("时间:")]),t._v(" "+t._s(t.parseTime(e.approvalTime)))]):t._e(),a("p",[a("strong",[t._v("结果:")]),t._v(" "+t._s(t.applicationStatusMap[e.status]))])]):t._e()])}),0),t.process.from.length&&["finance","from","to"].indexOf(this.type)>-1&&30!==t.process.status?a("div",[t._m(0),t._l(t.process.from,function(e,s){return a("van-panel",{key:"from-"+s,attrs:{title:"调出部门("+(s+1)+")"}},[a("van-cell",{attrs:{title:"部门"}},[t._v("\n        "+t._s(e.name)+"\n      ")]),a("van-cell",{attrs:{title:"金额(元)"}},[t._v("\n        "+t._s(e.amount)+"\n      ")])],1)}),a("van-panel",{attrs:{title:"调入部门"}},[t.application.group?a("van-cell",{attrs:{title:"部门"}},[t._v(" "+t._s(t.application.group.name))]):t._e(),a("van-cell",{ref:"processvalue",attrs:{title:"金额(元)",label:"结果自动计算"}},[t._v(t._s(t.total))])],1)],2):t._e(),t.process.from.length&&["from","to"].indexOf(this.type)>-1&&[50,60,61,62].indexOf(t.process.status)>-1?a("div",[a("div",{staticClass:"pz"},[a("h4",[t._v("调出部门领导审批结果")]),t._l(t.process.from,function(e,s){return a("div",{key:"frominfo-"+s},[e.approvalTime||e.approvalUser?a("div",{staticClass:"note"},[a("p",[a("strong",[t._v("审批人:")]),t._v(" "+t._s(e.approvalUser.userName))]),e.note?a("p",[a("strong",[t._v("意见:")]),t._v(" "+t._s(e.note))]):t._e(),e.approvalTime?a("p",[a("strong",[t._v("时间:")]),t._v(" "+t._s(t.parseTime(e.approvalTime)))]):t._e(),a("p",[a("strong",[t._v("结果:")]),t._v(" "+t._s(t.applicationStatusMap[e.status]))])]):t._e()])})],2)]):t._e(),t.process.to.length&&"to"===this.type&&[60,61,62].indexOf(t.process.status)>-1?a("div",[a("div",{staticClass:"pz"},[a("h4",[t._v("调出部门领导审批结果")]),t._l(t.process.to,function(e,s){return a("div",{key:"toinfo-"+s},[e.approvalTime?a("div",{staticClass:"note"},[a("p",[a("strong",[t._v("审批人:")]),t._v(" "+t._s(e.userName))]),e.note?a("p",[a("strong",[t._v("意见:")]),t._v(" "+t._s(e.note))]):t._e(),e.approvalTime?a("p",[a("strong",[t._v("时间:")]),t._v(" "+t._s(t.parseTime(e.approvalTime)))]):t._e(),a("p",[a("strong",[t._v("结果:")]),t._v(" "+t._s(t.applicationStatusMap[e.status]))])]):t._e()])})],2)]):t._e(),a("div",{staticClass:"pz2"},[a("p",[a("strong",[t._v("当前状态:")]),a("span",{staticClass:"statusz"},[t._v("  "+t._s(t.statusMap[t.process.status]))])])]),"application"===t.type&&[10,20].indexOf(t.process.status)>-1?a("div",[a("van-panel",{attrs:{title:"审批意见"}},[a("van-field",{attrs:{type:"textarea",placeholder:"审批意见（选填）"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}})],1),a("div",{staticClass:"button-area"},[a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"danger",plain:""},on:{click:t.reject}},[t._v("驳 回")])],1),a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.agree}},[t._v("同 意")])],1)],1)],1)],1):t._e(),"finance"===t.type&&30===t.process.status?a("div",[t._l(t.process.from,function(e,s){return a("van-panel",{key:"from-"+s},[a("div",{staticClass:"panel-head",attrs:{slot:"header"},slot:"header"},[a("van-row",[a("van-col",{staticClass:"title",attrs:{span:"22"}},[t._v("\n            "+t._s("调出部门("+(s+1)+")")+"\n          ")]),a("van-col",{staticClass:"handle",attrs:{span:"2"}},[a("van-icon",{attrs:{name:"delete",color:"red",size:"20px"},on:{click:function(e){return t.deleteFrom(s)}}})],1)],1)],1),a("van-cell",{attrs:{title:"部门","is-link":"",required:""},on:{click:function(e){return t.showPickDept(s)}}},[t._v("\n        "+t._s(e.name)+"\n      ")]),a("van-cell",{attrs:{title:"费用类型","is-link":"",required:""},on:{click:function(e){return t.showPickFeeType(s)}}},[t._v("\n        "+t._s(t.typeMap2[e.type])+"\n      ")]),a("van-field",{attrs:{type:"number",label:"金额(元)",placeholder:"请输入金额",required:""},on:{blur:t.computeAmount},model:{value:e.amount,callback:function(a){t.$set(e,"amount",a)},expression:"item.amount"}})],1)}),a("div",{staticClass:"button-area"},[a("van-button",{attrs:{block:"",type:"warning",plain:""},on:{click:t.addFrom}},[a("span",{staticClass:"icon-btn"},[t._v("+")]),t._v(" 增加调出项")])],1),a("van-panel",{attrs:{title:"调入部门"}},[t.application.group?a("van-cell",{attrs:{title:"部门"}},[t._v(" "+t._s(t.application.group.name))]):t._e(),a("van-cell",{attrs:{title:"费用类型"}},[t._v("\n        差旅费\n      ")]),a("van-cell",{ref:"processvalue",attrs:{title:"金额(元)",label:"结果自动计算"}},[t._v(t._s(t.total))])],1),a("div",{staticClass:"button-area"},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.modifyFinance}},[t._v("调 整")])],1)],2):t._e(),"finance"===t.type&&[40,50].indexOf(t.process.status)>-1?a("div",[a("div",{staticClass:"button-area"},[a("van-button",{attrs:{block:"",type:"warning",plain:""},on:{click:t.withdraw}},[t._v("撤 回")])],1)]):t._e(),"from"===t.type&&40===t.process.status?a("div",[a("van-panel",{attrs:{title:"审批意见"}},[a("van-field",{attrs:{type:"textarea",placeholder:"审批意见（选填）"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}})],1),a("div",{staticClass:"button-area"},[a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"danger",plain:""},on:{click:t.fromback}},[t._v("驳 回")])],1),a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.frompass}},[t._v("同 意")])],1)],1)],1)],1):t._e(),"to"===t.type&&50===t.process.status?a("div",[a("van-panel",{attrs:{title:"审批意见"}},[a("van-field",{attrs:{type:"textarea",placeholder:"审批意见（选填）"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}})],1),a("div",{staticClass:"button-area"},[a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"danger",plain:""},on:{click:t.toback}},[t._v("驳 回")])],1),a("van-col",{attrs:{span:"12"}},[a("van-button",{attrs:{block:"",type:"primary",plain:""},on:{click:t.topass}},[t._v("同 意")])],1)],1)],1)],1):t._e(),a("van-popup",{attrs:{position:"bottom"},model:{value:t.deptSelectShow,callback:function(e){t.deptSelectShow=e},expression:"deptSelectShow"}},[a("van-picker",{attrs:{columns:t.groupcolumns,"show-toolbar":!0},on:{cancel:function(e){t.deptSelectShow=!1},confirm:t.selectDept}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:t.feeTypeShow,callback:function(e){t.feeTypeShow=e},expression:"feeTypeShow"}},[a("van-picker",{attrs:{columns:t.feeTypeArray,"show-toolbar":!0},on:{cancel:function(e){t.feeTypeShow=!1},confirm:t.selectFeeType}})],1)],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pz"},[a("h4",[t._v("财务调整")])])}],o=(a("c5f6"),a("7f7f"),a("768b")),r=(a("ac4d"),a("8a81"),a("ac6a"),a("1946")),i={name:"budget",components:{FormBasic:r["a"]},data:function(){return{active:0,type:"applications",application:{group:{}},process:{group:{},from:[],to:[],count:0},processLists:[],note:"",applicationStatusMap:{10:"审批中",20:"同意",30:"拒绝"},feeTypeShow:!1,typeMap:{"差旅费":"trip","福利费":"benefits","其他":"others"},typeMap2:{trip:"差旅费",benefits:"福利费",others:"其他"},feeTypeArray:["差旅费","福利费","其他"],statusMap:{10:"审批中",11:"员工取消",20:"审批中",21:"主管拒绝",30:"财务调整中",31:"财务撤回",40:"调出部门审批中",50:"调入部门审批中",60:"审批通过",61:"审批通过",62:"审批通过"},groupLists:[],groupcolumns:[],total:0,fromIndex:0,deptSelectShow:!1}},methods:{parseTime:function(t){return t=new Date(t),"".concat(t.getFullYear(),"年").concat(t.getMonth()+1,"月").concat(t.getDate(),"日").concat(t.getHours(),"时").concat(t.getMinutes(),"分")},setType:function(){},getApplication:function(){var t=this;this.$route.query.id&&this.$http.get("/ec/api/applications/".concat(this.$route.query.id)).then(function(e){var a=e.data;0!==a.errcode?t.$toast.fail("获取费用申请单失败"):t.application=a.data})},initProcess:function(){this.processLists.push({title:"申请预算",userNames:[]});var t=!0,e=!1,a=void 0;try{for(var s,n=this.process.applications.entries()[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){var r=Object(o["a"])(s.value,2),i=r[0],c=r[1],p={title:"第".concat(i+1,"级主管审批"),userNames:[]};c.deptId===this.process.deptId&&(p.title="直接主管审批");var l=!0,u=!1,v=void 0;try{for(var f,h=c.users[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var d=f.value;p.userNames.push(d.userName)}}catch(w){u=!0,v=w}finally{try{l||null==h.return||h.return()}finally{if(u)throw v}}this.processLists.push(p)}}catch(w){e=!0,a=w}finally{try{t||null==n.return||n.return()}finally{if(e)throw a}}var m={title:"财务调整",userNames:[]},y=!0,_=!1,b=void 0;try{for(var g,k=this.process.finances.users[Symbol.iterator]();!(y=(g=k.next()).done);y=!0){c=g.value;m.userNames.push(c.userName)}}catch(w){_=!0,b=w}finally{try{y||null==k.return||k.return()}finally{if(_)throw b}}this.processLists.push(m),this.processLists.push({title:"预算调出部门领导审批",userNames:[]}),this.processLists.push({title:"预算调入部门领导审批",userNames:[]}),this.processLists.push({title:"预算调整",userNames:[]}),this.process.from.length||(this.process.from=this.process.from.concat({code:"",name:"",amount:0}),this.process.count=0),this.total=this.process.count},authority:function(){},getProcess:function(){var t=this;this.$route.query.id&&this.$http.get("/ec/api/processes/application/".concat(this.$route.query.id)).then(function(e){var a=e.data;if(0===a.errcode)return t.process=a.data,t.initProcess(),void t.authority()})},getGroupLists:function(){var t=this;this.$http.get("/ec/api/depts/grouplists").then(function(e){var a=e.data;if(0!==a.errcode);else{t.groupLists=a.data||[];var s=!0,n=!1,o=void 0;try{for(var r,i=t.groupLists[Symbol.iterator]();!(s=(r=i.next()).done);s=!0){var c=r.value;t.groupcolumns.push(c.name)}}catch(p){n=!0,o=p}finally{try{s||null==i.return||i.return()}finally{if(n)throw o}}}})},reject:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/reject"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("拒绝成功"),void t.getProcess();t.$toast.fail("拒绝失败")})},agree:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/agree"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},showPickFeeType:function(t){this.fromIndex=t||0,this.feeTypeShow=!0},selectFeeType:function(t){this.process.from[this.fromIndex].type=this.typeMap[t],this.feeTypeShow=!1},addFrom:function(){this.process.from||(this.process.from=[]),this.process.from=this.process.from.concat({code:"",name:"",amount:0})},deleteFrom:function(t){this.$delete(this.process.from,t),this.computeAmount()},computeAmount:function(){var t=0,e=!0,a=!1,s=void 0;try{for(var n,o=this.process.from[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;t+=Number(r.amount)}}catch(i){a=!0,s=i}finally{try{e||null==o.return||o.return()}finally{if(a)throw s}}this.$set(this.process,"count",t),this.total=t},showPickDept:function(t){this.fromIndex=t||0,this.deptSelectShow=!0},selectDept:function(t,e){if(this.name!==this.process.group.name){var a=this.groupLists[e];this.process.from[this.fromIndex].name=a.name,this.process.from[this.fromIndex].code=a.code,this.deptSelectShow=!1}else this.$toast("转入转出部门不能相同")},validateFinance:function(){var t=this.process.from||[],e=!0;if(!t.length||!this.process.count)return!1;var a=!0,s=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(a=(o=r.next()).done);a=!0){var i=o.value;if(!i.amount||!i.code||!i.type){e=!1;break}}}catch(c){s=!0,n=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw n}}return e},modifyFinance:function(){var t=this,e=this.validateFinance();e?this.$http.post("/api/processes/application/".concat(this.application.id,"/financesave"),{from:this.process.from}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")}):this.$toast("请正确填入调出项目")},withdraw:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/withdraw")).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},fromback:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/fromback"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},frompass:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/frompass"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},toback:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/toback"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})},topass:function(){var t=this;this.$http.post("/api/processes/application/".concat(this.application.id,"/topass"),{note:this.note}).then(function(e){var a=e.data;if(0===a.errcode)return t.$toast.success("操作成功"),void t.getProcess();t.$toast.fail("操作失败")})}},created:function(){this.type=this.$route.query.type||"application",this.getApplication(),this.getProcess(),"finance"===this.type&&this.getGroupLists()}},c=i,p=(a("18f3"),a("2877")),l=Object(p["a"])(c,s,n,!1,null,null,null);e["default"]=l.exports},"5d73":function(t,e,a){t.exports=a("469f")},"768b":function(t,e,a){"use strict";var s=a("a745"),n=a.n(s);function o(t){if(n()(t))return t}var r=a("5d73"),i=a.n(r);function c(t,e){var a=[],s=!0,n=!1,o=void 0;try{for(var r,c=i()(t);!(s=(r=c.next()).done);s=!0)if(a.push(r.value),e&&a.length===e)break}catch(p){n=!0,o=p}finally{try{s||null==c["return"]||c["return"]()}finally{if(n)throw o}}return a}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function l(t,e){return o(t)||c(t,e)||p()}a.d(e,"a",function(){return l})},"7d7b":function(t,e,a){var s=a("e4ae"),n=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return s(e.call(t))}},"7f7f":function(t,e,a){var s=a("86cc").f,n=Function.prototype,o=/^\s*function ([^ (]*)/,r="name";r in n||a("9e1e")&&s(n,r,{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},"8d3c":function(t,e,a){},9003:function(t,e,a){var s=a("6b4c");t.exports=Array.isArray||function(t){return"Array"==s(t)}},a745:function(t,e,a){t.exports=a("f410")},f410:function(t,e,a){a("1af6"),t.exports=a("584a").Array.isArray}}]);
//# sourceMappingURL=chunk-e1560162.dc5283b3.js.map