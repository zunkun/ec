(function(t){function e(e){for(var a,n,c=e[0],o=e[1],l=e[2],d=0,u=[];d<c.length;d++)n=c[d],r[n]&&u.push(r[n][0]),r[n]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);p&&p(e);while(u.length)u.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],a=!0,c=1;c<i.length;c++){var o=i[c];0!==r[o]&&(a=!1)}a&&(s.splice(e--,1),t=n(n.s=i[0]))}return t}var a={},r={app:0},s=[];function n(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=a,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/ecmobile/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var p=o;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"30f1f":function(t,e,i){"use strict";var a=i("82ff"),r=i.n(a);r.a},"56d7":function(t,e,i){"use strict";i.r(e);i("28a5"),i("96cf");var a=i("3b8d"),r=(i("c5f6"),i("cadf"),i("551c"),i("f751"),i("097d"),i("2b0e")),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("van-panel",{staticClass:"task-panel1"},[i("div",{attrs:{slot:"header",hidden:""},slot:"header"}),i("van-cell-group",[i("van-cell",{attrs:{title:"姓名",value:t.trip.userName}}),i("van-cell",{attrs:{title:"部门","is-link":"",value:t.trip.deptName},on:{click:t.showSelectDept}}),i("van-cell",{attrs:{title:"预算余额(元)",value:t.trip.balance}}),t.trip.balance>0?i("van-field",{attrs:{label:"出差事由",required:"",placeholder:"请输入出差事由"},model:{value:t.trip.reason,callback:function(e){t.$set(t.trip,"reason",e)},expression:"trip.reason"}}):t._e(),t.trip.balance<=0?i("p",{staticClass:"desc"},[t._v(t._s(t.trip.deptName)+"部门预算不足，不能提交出差")]):t._e()],1)],1),t.trip.balance>0?i("div",{staticClass:"z-w"},[t._l(t.trip.itineraries,function(e,a){return i("van-panel",{key:"it-"+a,staticClass:"task-panel"},[i("div",{staticClass:"trip-head",attrs:{slot:"header"},slot:"header"},[i("van-row",[i("van-col",{staticClass:"title",attrs:{span:"20"}},0===a?[t._v("\n            行程\n          ")]:[t._v("\n            "+t._s("行程("+(a+1)+")")+"\n          ")]),1!==t.trip.itineraries.length?i("van-col",{staticClass:"handle",attrs:{span:"4"}},[i("span",{staticClass:"text-danger",on:{click:function(e){return t.deleteItinerary(a)}}},[t._v("删除")])]):t._e()],1)],1),i("van-cell-group",[i("van-cell",{staticClass:"trans",attrs:{title:"交通工具"}},t._l(t.trafficTypeMap,function(r,s){return i("van-button",{key:"trafficTypeId"+a+"-"+s,attrs:{type:"info",size:"small",plain:e.trafficTypeId!==Number(s),text:r},on:{click:function(i){return t.selectTrafficType(e,r,s)}}})}),1),3===e.trafficTypeId?i("van-field",{attrs:{required:"",placeholder:"请填写交通工具名称（必填）"},model:{value:e.trafficTypeName,callback:function(i){t.$set(e,"trafficTypeName",i)},expression:"it.trafficTypeName"}}):t._e(),i("van-cell",{staticClass:"trans",attrs:{title:"单程往返"}},t._l(["单程","往返"],function(r,s){return i("van-button",{key:"tripway"+a+"-"+s,attrs:{type:"info",size:"small",plain:e.tripwayId!==s,text:r},on:{click:function(i){return t.selectTripway(e,s)}}})}),1),2==t.trafficTypeId||3==t.trafficTypeId?i("van-field",{attrs:{label:"出发城市",required:"",placeholder:"出发城市"},model:{value:e.depCity,callback:function(i){t.$set(e,"depCity",i)},expression:"it.depCity"}}):t._e(),2==t.trafficTypeId||3==t.trafficTypeId?i("van-field",{attrs:{label:"目的城市",required:"",placeholder:"目的城市"},model:{value:e.arrCity,callback:function(i){t.$set(e,"arrCity",i)},expression:"it.arrCity"}}):t._e(),0==t.trafficTypeId||1==t.trafficTypeId?i("van-cell",{attrs:{title:"出发城市",required:"","is-link":"",value:e.depCity},on:{click:function(e){return t.chooseCity(a,"depCity")}}}):t._e(),0==t.trafficTypeId||1==t.trafficTypeId?i("van-cell",{attrs:{title:"目的城市",required:"","is-link":"",value:e.arrCity},on:{click:function(e){return t.chooseCity(a,"arrCity")}}}):t._e(),i("van-cell",{attrs:{title:"开始时间",required:"","is-link":"",value:e.depDateStr},on:{click:function(i){return t.chooseDate(e,"depDate",e.depDate)}}}),i("van-cell",{attrs:{title:"结束时间",required:"","is-link":"",value:e.arrDateStr},on:{click:function(i){return t.chooseDate(e,"arrDate",e.arrDate)}}}),i("van-cell",{attrs:{title:"时长（天）",required:"",label:"自动计算时长",value:e.tripDay}})],1)],1)}),i("div",{staticClass:"itbtn"},[i("van-button",{attrs:{block:"",type:"info",plain:""},on:{click:t.addItinerary}},[i("span",{staticClass:"icon-btn"},[t._v("+")]),t._v(" 增加行程")])],1),i("van-panel",{staticClass:"task-panel",attrs:{title:"出差备注"}},[i("van-cell-group",[i("van-field",{attrs:{type:"textarea",placeholder:"请输入具体的出差备注（选填，少于500字）"},model:{value:t.trip.remark,callback:function(e){t.$set(t.trip,"remark",e)},expression:"trip.remark"}})],1)],1),i("van-panel",{staticClass:"task-panel"},[i("div",{attrs:{slot:"header",hidden:""},slot:"header"}),i("van-cell-group",[i("van-cell",{attrs:{title:"同行人员","is-link":"",value:t.fellowStr},on:{click:t.chooseFellows}})],1)],1),i("div",{staticClass:"itbtn"},[i("van-button",{attrs:{block:"",type:"info"},on:{click:t.commit}},[t._v(" 提 交 出 差")])],1)],2):t._e(),i("van-popup",{staticClass:"popup-z",attrs:{position:"right",overlay:!1,duration:0},model:{value:t.stationShow,callback:function(e){t.stationShow=e},expression:"stationShow"}},[i("Station",{attrs:{trafficTypeId:t.trafficTypeId},on:{closepage:t.closePage}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.deptSelectShow,callback:function(e){t.deptSelectShow=e},expression:"deptSelectShow"}},[i("van-picker",{attrs:{columns:t.departments,"show-toolbar":!0},on:{cancel:function(e){t.deptSelectShow=!1},confirm:t.selectDept}})],1)],1)},n=[],c=(i("7f7f"),i("ac4d"),i("8a81"),i("ac6a"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"station"}},[i("div",{staticClass:"s-h"},[i("van-search",{attrs:{placeholder:"中文/拼音/首字母","show-action":!0},on:{input:t.onSearch,search:t.onSearch},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}},[i("div",{attrs:{slot:"action"},on:{click:t.onSearch},slot:"action"},[t._v("搜索")])])],1),t.inSearch?t._e():i("van-index-bar",{attrs:{"index-list":t.indexList}},[i("van-index-anchor",{staticClass:"p-label2",attrs:{index:"历史"}},[t._v("历史"+t._s(t.trafficTypeId))]),i("div",{staticClass:"p-content"},[i("van-row",t._l(t.hiscities,function(e,a){return i("van-col",{key:"city-"+a,attrs:{span:"6"}},[i("van-button",{staticClass:"h-btn",attrs:{type:"info",color:"#1989fa",size:"small",plain:"",text:e},on:{click:function(i){return t.pickCity(e)}}})],1)}),1)],1),i("van-index-anchor",{staticClass:"p-label2",attrs:{index:"热门"}},[t._v("热门城市")]),i("div",{staticClass:"p-content"},[i("van-row",t._l(t.hotcities,function(e,a){return i("van-col",{key:"city-"+a,attrs:{span:"6"}},[i("van-button",{staticClass:"h-btn",attrs:{type:"info",color:"#1989fa",size:"small",plain:"",text:e},on:{click:function(i){return t.pickCity(e)}}})],1)}),1)],1),t._l(t.cityLists,function(e,a){return i("div",{key:"cityLists-"+a},[i("van-index-anchor",{staticClass:"p-label",attrs:{index:a}},[t._v(t._s(a))]),i("div",{staticClass:"p-content"},t._l(e,function(e,r){return i("div",{key:"city-"+a+r,staticClass:"s-lists",on:{click:function(i){return t.pickCity(e.city)}}},[i("div",[t._v("\n              "+t._s(e.city)+" "),e.abbr?i("span",{staticClass:"s-tip"},[t._v(t._s(e.abbr))]):t._e()])])}),0)],1)})],2),t.inSearch?i("div",{staticClass:"station-lists"},[i("div",{staticClass:"p-content"},t._l(t.searchCities,function(e,a){return i("div",{key:"city-"+a,staticClass:"s-lists",on:{click:function(i){return t.pickCity(e.city)}}},[i("div",[t._v("\n              "+t._s(e.city)+" "),e.abbr?i("span",{staticClass:"s-tip"},[t._v(t._s(e.abbr))]):t._e()])])}),0)]):t._e()],1)}),o=[],l=(i("456d"),{name:"Station",props:["trafficTypeId"],data:function(){return{keywords:"",cityName:"",inSearch:!1,indexList:["历史","热门"],hotcities:["郑州","重庆","天津","西安","广州","深圳","成都","厦门","长沙","武汉","昆明","大连","杭州","南京","北京","上海"],hiscities:[],cityLists:{},searchCities:[]}},methods:{onSearch:function(){var t=this;if(!this.keywords)return this.inSearch=!1,void(this.searchCities=[]);this.inSearch=!0,this.$http.get("/ec/api/area/search?type=".concat(this.trafficTypeId,"&keywords=").concat(this.keywords)).then(function(e){var i=e.data;if(t.searchCities=[],0===i.errcode){for(var a=0,r=Object.keys(i.data);a<r.length;a++)r[a];t.searchCities=i.data||[]}})},getLists:function(){var t=this,e=this;this.$http.get("/ec/api/area/cities?type=".concat(this.trafficTypeId)).then(function(i){var a=i.data;if(0===a.errcode){for(var r=0,s=Object.keys(a.data);r<s.length;r++){var n=s[r];e.indexList.push(n)}t.cityLists=a.data}})},initHis:function(){this.hiscities=JSON.parse(localStorage.getItem("hiscities".concat(this.trafficTypeId))||"[]"),this.hiscities.length>7&&this.hiscities.splice(7)},addHis:function(t){this.hiscities||(this.hiscities=[]),this.hiscities.indexOf(t)>-1||(this.hiscities.length>7&&this.hiscities.splice(7),this.hiscities.unshift(t),localStorage.setItem("hiscities".concat(this.trafficTypeId),JSON.stringify(this.hiscities)))},pickCity:function(t){this.inSearch=!1,this.keywords="",this.searchCities=[],this.cityName=t,this.addHis(this.cityName),this.$emit("closepage",this.cityName)},goBack:function(){this.inSearch=!1,this.keywords="",this.searchCities=[],this.$emit("closepage",this.cityName),history.pushState(null,null,document.URL)}},created:function(){this.trafficTypeId=this.trafficTypeId||0,this.getLists(),this.initHis()},mounted:function(){window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1))},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1)},watch:{trafficTypeId:function(t,e){return this.getLists(),this.initHis(),t}}}),p=l,d=(i("30f1f"),i("58c3"),i("2877")),u=Object(d["a"])(p,c,o,!1,null,"473912a7",null),f=u.exports,h={name:"home",components:{Station:f},data:function(){return{departments:[],departmentLists:[],trafficTypeMap:{0:"飞机",1:"火车",2:"汽车",3:"其他"},tripwayMap:{0:"单程",1:"往返"},trafficTypeId:0,cityType:"",itIndex:0,defaultIt:{trafficTypeId:0,trafficTypeName:"飞机",tripwayId:0,tripwayName:"单程",depCity:"",arrCity:"",depDate:"",depDateStr:"",arrDate:"",arrDateStr:"",tripDay:""},trip:{userId:"",userName:"",deptId:"",deptName:"",balance:1e3,reason:"",itineraries:[],remark:"",fellowUserIds:[],fellowUsers:[]},fellowDepts:[],fellowDeptIds:[],fellowCount:"",fellowStr:"",stationShow:!1,deptSelectShow:!1,errMsg:""}},methods:{getBalance:function(t){this.trip.balance=1300},initTrip:function(){this.trip={userId:this.trip.userId,userName:this.trip.userName,deptId:this.trip.deptId,deptName:this.trip.deptName,balance:0,reason:"",itineraries:[],remark:"",fellowUserIds:[],fellowUsers:[]},this.fellowDepts=[],this.fellowDeptIds=[],this.fellowCount="",this.fellowStr="",this.itIndex=0,this.addItinerary(),this.getBalance()},selectTrafficType:function(t,e,i){i=Number(i),t.trafficTypeId!==i&&(t.trafficTypeId=i,t.trafficTypeName=e,3===i&&(t.trafficTypeName=""),t.depCity="",t.arrCity="",this.trafficTypeId=i)},selectTripway:function(t,e){t.tripwayId=e,t.tripwayName=this.tripwayMap[e]},isSameDay:function(t,e){var i=new Date(t),a=new Date(e);return i.setHours(0,0,0,0)==a.setHours(0,0,0,0)},parseDate2Str:function(t){var e=new Date(t||""),i=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),s=a<=9?"0".concat(a):a,n=r<=9?"0".concat(r):r;return"".concat(i,"年").concat(s,"月").concat(n,"日")},parseTripDay:function(t,e){if(t&&e)return Math.abs(Math.ceil((e-t)/864e5))},chooseDate:function(t,e,i){var a=this,r=this,s=Date.now();"arrDate"===e&&t.depDate&&(s=t.arrDate),i&&(s=i),this.$dd.ready(function(){a.$dd.biz.calendar.chooseOneDay({default:s,onSuccess:function(i){var a=i.chosen,s=new Date(a).setHours(0,0,0,0),n=new Date(a).setHours(23,59,59,59),c="depDate"===e?s:t.depDate,o="arrDate"===e?n:t.arrDate;c&&o&&o<c&&!r.isSameDay(o,c)||(t[e]="depDate"===e?c:o,t["".concat(e,"Str")]=r.parseDate2Str(a),t.tripDay=r.parseTripDay(c,o))}})})},addItinerary:function(){this.trip.itineraries.push(JSON.parse(JSON.stringify(this.defaultIt)))},deleteItinerary:function(t){this.trip.itineraries.length>1&&this.$delete(this.trip.itineraries,t)},chooseFellows:function(){var t=JSON.parse(localStorage.getItem("config")||{}),e=this;this.$dd.ready(function(){e.$dd.biz.contact.complexPicker({title:"选择同行人员",corpId:t.corpId,multiple:!0,limitTips:"最多只能选择10人",maxUsers:10,pickedUsers:e.trip.fellowUserIds,appId:t.agentId,responseUserOnly:!0,startWithDepartmentId:0,onSuccess:function(t){e.trip.fellowUsers=t.users,e.trip.fellowUserIds=[],e.fellowCount=e.selectedCount,e.fellowStr="";var i=[],a=!0,r=!1,s=void 0;try{for(var n,c=t.users[Symbol.iterator]();!(a=(n=c.next()).done);a=!0){var o=n.value;e.trip.fellowUserIds.push(o.emplId),i.push(o.name)}}catch(l){r=!0,s=l}finally{try{a||null==c.return||c.return()}finally{if(r)throw s}}t.users.length<=3?e.fellowStr=i.join("、"):e.fellowStr="".concat(i[0],"、").concat(i[1],"等").concat(t.selectedCount,"人")}})})},chooseCity:function(t,e){0===this.trafficTypeId||1===this.trafficTypeId?(this.itIndex=t,this.cityType=e,this.stationShow=!0):this.stationShow=!1},closePage:function(t){this.stationShow=!1,t&&(this.trip.itineraries[this.itIndex][this.cityType]=t)},showSelectDept:function(){this.departments.length<=1||(this.deptSelectShow=!0)},selectDept:function(t,e){this.trip.deptId=this.departmentLists[e].deptId,this.trip.deptName=t,this.deptSelectShow=!1,this.getBalance(this.trip.deptId)},setErrMsg:function(t){this.errMsg||(this.errMsg=t)},validate:function(){var t=!0;if(this.errMsg="",this.trip.userId||(t=!1,this.setErrMsg("无法获取当前用户信息")),this.trip.deptId||(t=!1,this.setErrMsg("无法获取当前用户部门信息")),this.trip.reason||(t=!1,this.setErrMsg("请输入出差事由")),this.trip.balance<=0&&(t=!1,this.setErrMsg("当前部门预算余额不足")),!t)return!1;var e=!0,i=!1,a=void 0;try{for(var r,s=this.trip.itineraries[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var n=r.value;if(0!==n.trafficTypeId&&!n.trafficTypeId){t=!1,this.setErrMsg("无法获取交通工具信息");break}if(3===n.trafficTypeId&&!n.trafficTypeName){t=!1,this.setErrMsg("请填写交通工具名称");break}if(!n.depCity){t=!1,this.setErrMsg("请选择出发城市");break}if(!n.arrCity){t=!1,this.setErrMsg("请选择目的城市");break}if(!n.depDate){t=!1,this.setErrMsg("请选择开始时间");break}if(!n.arrDate){t=!1,this.setErrMsg("请选择结束时间");break}}}catch(c){i=!0,a=c}finally{try{e||null==s.return||s.return()}finally{if(i)throw a}}return t},commit:function(){var t=this,e=this.validate();e?this.$http.post("/ec/api/trips",this.trip).then(function(e){var i=e.data;0===i.errcode?(t.$toast.success("出差申请成功"),t.initTrip()):t.$toast(i.errmsg)}).catch(function(){t.$toast("出差申请失败")}):this.$toast(this.errMsg)}},created:function(){var t=JSON.parse(localStorage.getItem("user"))||{};this.trip.userId=t.userId,this.trip.userName=t.userName;var e=t.departments||[];if(e.length){this.trip.deptId=e[0].deptId,this.trip.deptName=e[0].deptName;var i=!0,a=!1,r=void 0;try{for(var s,n=e[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var c=s.value;this.departments.push(c.deptName)}}catch(o){a=!0,r=o}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}this.departmentLists=e}this.getBalance(this.trip.deptId),this.addItinerary()}},y=h,v=(i("8867"),Object(d["a"])(y,s,n,!1,null,"55aa603f",null)),m=v.exports,g=i("bc3a"),b=i.n(g),w={development:{corpId:"dingcbcbb63d3edd5478",corpName:"上海铭悦软件有限公司"},production:{corpId:"ding9f71dd70c3adb557",corpName:"海尔融资租赁股份有限公司"}},I=w,S=i("2c18"),k=(i("157a"),i("e41f")),C=i("543e"),T=i("ea47"),_=i("7744"),D=i("34e9"),x=i("565f"),N=i("b650"),M=i("d1e1"),O=i("9ffb"),$=i("ad06"),L=i("d961"),j=i("e11d"),E=i("92e2"),U=i("f253"),z=i("2241"),q=i("d399");r["a"].use(k["a"]),r["a"].use(C["a"]),r["a"].use(T["a"]),r["a"].use(_["a"]),r["a"].use(D["a"]),r["a"].use(x["a"]),r["a"].use(N["a"]),r["a"].use(M["a"]),r["a"].use(O["a"]),r["a"].use($["a"]),r["a"].use(L["a"]),r["a"].use(j["a"]),r["a"].use(E["a"]),r["a"].use(U["a"]),r["a"].use(z["a"]),r["a"].use(q["a"]),r["a"].config.productionTip=!1,r["a"].prototype.GLOBAL=I,r["a"].prototype.$http=b.a,r["a"].prototype.$dd=S,new r["a"]({render:function(t){return t(m)}}).$mount("#app");var P=localStorage.getItem("token"),J=Number(localStorage.getItem("expire"))||0;!P||J<Date.now()?S["ready"](function(){S["runtime"].permission.requestAuthCode({corpId:I["production"].corpId||"dingcbcbb63d3edd5478",onSuccess:function(t){b.a.get("/ec/api/auth/login?corpId=".concat(I.corpId,"&code=").concat(t.code)).then(function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(e){var i,a,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i=e.data,0===i.errcode&&(a=i.data.user,r=i.data.token,localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("token",r),localStorage.setItem("expire",Date.now()+864e5),window.location.reload());case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(){})},onFail:function(){}})}):b.a.interceptors.request.use(function(t){return t.headers.Authorization=localStorage.getItem("token"),t},function(t){return Promise.reject(t)}),S["ready"](function(){b.a.get("/ec/api/auth/signature?platform=ecmobile&url="+window.location.href.split("#")[0]).then(function(t){var e=t.data;if(0===e.errcode){var i=e.data;localStorage.setItem("config",JSON.stringify(e.data)),S["config"]({agentId:i.agentId,corpId:i.corpId,timeStamp:i.timeStamp,nonceStr:i.nonceStr,signature:i.signature,type:0,jsApiList:["runtime.info","biz.contact.choose","biz.util.datepicker","biz.contact.complexPicker"]})}})})},"58c3":function(t,e,i){"use strict";var a=i("f70d"),r=i.n(a);r.a},"82ff":function(t,e,i){},8867:function(t,e,i){"use strict";var a=i("e92d"),r=i.n(a);r.a},e92d:function(t,e,i){},f70d:function(t,e,i){}});
//# sourceMappingURL=app.7528a747.js.map